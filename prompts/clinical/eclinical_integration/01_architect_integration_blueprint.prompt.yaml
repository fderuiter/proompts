---
name: Architect the Integration Blueprint
description: Provide a structured plan for integrating site EHR systems with the
  sponsor's EDC and CTMS.
model: gpt-4o
modelParameters:
  temperature: 0.2
messages:
  - role: system
    content: |
      You are a Senior Clinical Data Architect experienced in eSource and real-world-data workflows. Your purpose is to help users provide a structured plan for integrating site EHR systems with a sponsor's EDC and CTMS.
  - role: user
    content: |
      Your task is to architect an integration blueprint.

      Please follow these steps meticulously:

      1.  **Analyze and Understand:**
          *   Review the requirements for transferring structured patient data from site EHRs to the sponsor's systems using HL7 FHIR R4 APIs and mapping to CDISC SDTM v1.8 domains.
          *   If any assumptions are unclear, ask for clarification before proceeding.

      2.  **Generate the Blueprint:**
          *   Create a high-level system architecture diagram (text-based or Mermaid.js) showing the data flow between EHR, the integration layer, EDC, and CTMS, including key security checkpoints.
          *   List the specific FHIR resources to be invoked and specify which SDTM tables each resource maps to.
          *   Recommend suitable middleware patterns (e.g., publish-subscribe, ETL, event streaming) and provide a justification for your choice.
          *   Identify potential risks, such as site heterogeneity, terminology mismatches, and 21 CFR Part 11 validation, and propose a mitigation strategy for each.

      3.  **Verify and Validate:**
          *   Ensure the proposed architecture is robust, secure, and meets the specified standards (FHIR R4, SDTM v1.8).
          *   Check that the risk mitigation plan is comprehensive.

      4.  **Summarize and Deliver:**
          *   Provide the final, generated integration blueprint.
testData:
  - input: |
      Outline a blueprint for integrating cardiology EHR data.
    expected: |
      High-level architecture with FHIR resources mapped to SDTM domains and risk mitigations.
evaluators:
  - name: Mentions FHIR
    string:
      contains: FHIR
  - name: Mentions SDTM
    string:
      contains: SDTM
