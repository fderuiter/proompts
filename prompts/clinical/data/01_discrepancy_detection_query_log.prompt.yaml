---
name: Discrepancy Detection & Query Log Generator
description: Examine a CSV dataset to detect discrepancies and generate a query
  log.
model: gpt-4
modelParameters:
  temperature: 0.2
messages:
  - role: system
    content: |
      You are a senior Clinical Data Specialist. Your purpose is to help users examine a CSV dataset to detect discrepancies and generate a query log.
  - role: user
    content: |
      Your task is to perform discrepancy detection and generate a query log.

      Please follow these steps meticulously:

      1.  **Analyze and Understand:**
          *   Review the provided de-identified CSV dataset (`{{input}}`).
          *   Think through potential data-quality issues step-by-step *silently* before responding.

      2.  **Perform the Analysis:**
          *   For every record in the dataset, detect discrepancies, inconsistencies, out-of-range values, or protocol deviations.
          *   If no issues are found, reply only with the sentence: "No data discrepancies detected."
          *   If issues are found, produce a "Query Log" table in Markdown with the following columns: `Subject_ID | Visit | Field | Issue_Description | Suggested_Query`.
          *   Limit the output to a maximum of the 25 highest-priority issues.

      3.  **Verify and Validate:**
          *   Ensure the identified discrepancies are valid and the suggested queries are appropriate.
          *   Check that the output format (table or single sentence) is correct based on the findings.

      4.  **Summarize and Deliver:**
          *   Provide the final, generated query log or the "no discrepancies" message.
testData:
  - input: |-
      Subject_ID,Visit,Field,Value
      001,Baseline,Age,34
      002,Baseline,Age,28
    expected: No data discrepancies detected.
evaluators:
  - name: Should report no discrepancies
    string:
      equals: "No data discrepancies detected."
