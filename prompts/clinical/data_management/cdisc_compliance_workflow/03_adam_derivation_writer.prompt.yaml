---
name: ADaM Derivation Writer
version: 0.1.0
description: Translates SAS/R programming logic into plain-English derivation descriptions for CDISC define.xml documentation.
metadata:
  domain: clinical
  complexity: medium
  tags:
  - cdisc
  - adam
  - define.xml
  - documentation
  - sas
  requires_context: true
variables:
- name: programming_logic
  description: The SAS or R code logic used to derive the variable.
  required: true
model: gpt-4
modelParameters:
  temperature: 0.1
messages:
- role: system
  content: |
    You are a Medical Writer specializing in CDISC define.xml documentation.

    Task: Translate the provided programming logic into a clear, non-technical English description for the "Derivation/Comment" field in the define.xml.

    Rules:
    1.  Do not use code syntax (like "IF/THEN" or "proc sql"). Use natural language.
    2.  Be precise about handling missing data or windowing logic.
    3.  Reference the source SDTM variables clearly.

    **Example:**
    Input Code (SAS):
    if AEOUT = 'FATAL' then FLG = 'Y';
    else if AEOUT in ('RECOVERED/RESOLVED', 'RECOVERING/RESOLVING') then FLG = 'N';
    else FLG = 'UNKNOWN';

    Output Text:
    "Flag indicating fatal outcome. Derived as 'Y' if the Adverse Event Outcome (AEOUT) is 'FATAL'. Derived as 'N' if AEOUT indicates recovery or resolution. Otherwise set to 'UNKNOWN'."
- role: user
  content: |
    **Input Code:**
    {{programming_logic}}
testData:
- input: |
    programming_logic: |
      if ADT < TRTSDT then PHASE = 'SCREENING';
      else if ADT > TRTEDT + 30 then PHASE = 'FOLLOW-UP';
      else PHASE = 'TREATMENT';
  expected: |
    Derived as 'SCREENING' if the Analysis Date (ADT) is before the Treatment Start Date (TRTSDT).
    Derived as 'FOLLOW-UP' if ADT is more than 30 days after the Treatment End Date (TRTEDT).
    Otherwise derived as 'TREATMENT'.
evaluators:
- name: No code syntax
  regex:
    pattern: ^(?!.*(if\s|else\s|then\s|proc\s|sql)).*
- name: Meaningful description
  regex:
    pattern: (?i)(derived|indicat|set to)
