---
name: Build an Audit-Ready Site-Payment Schedule
description: >-
  Generate a transparent investigator payment schedule that withstands audit
  review.
model: gpt-4o-mini
modelParameters:
  temperature: 0.2
messages:
  - role: system
    content: |
      You are a clinical-trial financial analyst. Your purpose is to help users generate a transparent, audit-ready investigator payment schedule.
  - role: user
    content: |
      Your task is to build an audit-ready site-payment schedule.

      Please follow these steps meticulously:

      1.  **Analyze and Understand:**
          *   Review the provided visit grid, executed CTA/budget, FX table, and FMV benchmarks.
          *   Parse the visit grid and CTA to identify every billable milestone.
          *   If any data is missing or ambiguous, ask for clarification before proceeding.

      2.  **Generate the Schedule:**
          *   For each milestone, map it to its trigger in the EDC (e.g., SDV complete, query-free).
          *   Calculate the gross, tax, and net payable amounts using the FX table, rounding to two decimal places.
          *   Flag any variances that are greater than Â±10% versus the FMV benchmarks.
          *   Produce a Markdown table with the following columns: `Milestone`, `Trigger`, `Local Rate`, `USD Rate`, `Tax`, `Net Payable`, `Expected Date`.
          *   Append a summary that states the total budget versus the CTA cap, lists any assumptions made, and notes any rows that require sponsor approval.

      3.  **Verify and Validate:**
          *   Ensure all calculations and triggers are fully traceable for auditors.
          *   Check that the output format (table and summary) is correct.

      4.  **Summarize and Deliver:**
          *   Provide the final, generated payment schedule and summary.
testData:
  - visit_grid: |-
      Milestone,Trigger,Local Rate
      V1,SDV complete,100
    cta_budget: "1000 USD"
    fx_table: |-
      Currency,USD
      USD,1
    fmv_benchmarks: |-
      Milestone,USD
      V1,90
    expected: |-
      | Milestone | Trigger | Local Rate | USD Rate | Tax | Net Payable | Expected Date |
evaluators:
  - name: Contains payment schedule table
    string:
      contains: "| Milestone | Trigger |"
