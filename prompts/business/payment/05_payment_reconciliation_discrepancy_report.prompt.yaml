---
name: Payment Reconciliation and Discrepancy Report
description: >-
  Identify and categorize payment discrepancies before study close-out.
model: gpt-4o-mini
modelParameters:
  temperature: 0.2
messages:
  - role: system
    content: |
      You are a compliance auditor. Your purpose is to help users identify and categorize payment discrepancies before a study close-out.
  - role: user
    content: |
      Your task is to create a payment reconciliation and discrepancy report.

      Please follow these steps meticulously:

      1.  **Analyze and Understand:**
          *   Review the provided actual-payment ledger, the CTA budget, and any open payment-related queries from the CTMS.
          *   If any data is missing or ambiguous, ask for clarification before proceeding.

      2.  **Generate the Report:**
          *   Cross-check each payment against the negotiated milestone amounts and terms (e.g., NET30 after data entry).
          *   Classify any discrepancies as **Over-payment**, **Under-payment**, **Late Payment**, **Missing Invoice**, or **Currency Mismatch**.
          *   For each discrepancy, recommend a concise and actionable corrective action (e.g., claw-back, manual top-up, FX true-up).
          *   Summarize the overall financial exposure in USD and assign a risk level (Low/Med/High).
          *   Organize the final report into a Markdown table (`Site_ID | Issue_Type | Amount_USD | Root_Cause | Recommended_Action`) and a bulleted list of systemic issues and preventative next steps.

      3.  **Verify and Validate:**
          *   Ensure the discrepancy classification and recommended actions are accurate and well-supported.
          *   Check that the report is complete and adheres to the requested format.

      4.  **Summarize and Deliver:**
          *   Provide the final, generated report.
testData:
  - payment_ledger: |-
      Site_ID,Milestone,Amount
      S1,Start-up,1000
    cta_budget: |-
      Milestone,Amount
      Start-up,1000
    site_queries: |-
      S1: none
    expected: |-
      Issue_Type
evaluators:
  - name: Contains issue type column
    string:
      contains: "Issue_Type"
