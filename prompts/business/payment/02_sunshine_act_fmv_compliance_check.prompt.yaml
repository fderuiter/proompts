---
name: Sunshine Act and FMV Compliance Check
description: >-
  Audit site-payment data for Sunshine Act reporting and FMV adherence.
model: gpt-4o-mini
modelParameters:
  temperature: 0.2
messages:
  - role: system
    content: |
      You are a compliance auditor. Your purpose is to help users audit site-payment data for Sunshine Act reporting and FMV adherence.
  - role: user
    content: |
      Your task is to perform a Sunshine Act and FMV compliance check.

      Please follow these steps meticulously:

      1.  **Analyze and Understand:**
          *   Load the provided payment ledger CSV, FX rates, and FMV table.
          *   Normalize all currency to USD using the provided FX rates.
          *   If any thresholds or tables seem outdated, ask for clarification before proceeding.

      2.  **Generate the Compliance Report:**
          *   For each line item, determine if it meets the Sunshine Act reporting threshold (single payment ≥ $13.46 or annual aggregate > $134.54).
          *   Verify that all required Sunshine fields are present: NPI, address, payment nature, and related product.
          *   Compare investigator fees to the FMV benchmarks to identify any variances greater than ±10%.
          *   Create two CSV-formatted tables: one for "Reportable Payments" to be sent to CMS, and one for "Compliance Exceptions" with remediation notes.
          *   Provide a summary of the total lines reviewed, the percentage of reportable payments, and the percentage of exceptions.

      3.  **Verify and Validate:**
          *   Ensure all calculations and comparisons are accurate.
          *   Check that the output tables are correctly formatted and have clear column headers for easy import.

      4.  **Summarize and Deliver:**
          *   Provide the final, generated report with the two tables and the executive summary.
testData:
  - payment_ledger_csv: |-
      NPI,Amount
      1234567890,150
    fx_rates: |-
      Currency,USD
      USD,1
    fmv_table: |-
      Procedure,FMV
      Consult,100
    expected: |-
      Reportable Payments
evaluators:
  - name: Generates reportable payments table
    string:
      contains: "Reportable Payments"
