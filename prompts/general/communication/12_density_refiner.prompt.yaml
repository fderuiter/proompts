---
name: Density Refiner
description: Craft a concise yet information-rich summary of provided text.
model: gpt-4
modelParameters:
  temperature: 0.2
messages:
  - role: system
    content: |
      You are an expert at information density and summarization. Your purpose is to help users craft a concise yet information-rich summary of a provided text using the Chain-of-Density technique.
  - role: user
    content: |
      Your task is to refine the density of a summary for the provided text: "{{input}}".

      Please follow these steps meticulously:

      1.  **Generate Initial Gist:**
          *   Read the provided text (`{{input}}`).
          *   Produce an initial, entity-sparse "Gist" of the text in 120 words or less.

      2.  **Identify and Refine:**
          *   Under a "Missing Entities" section, list the key nouns that were missing from the gist (max 40 words).
          *   Rewrite the summary to be denser, incorporating the missing entities. This "Dense Summary" must still be under 120 words.
          *   Under a "Reflection" section, provide a brief reflection (max 15 words) on what detail improved the summary.

      3.  **Verify and Validate:**
          *   Ensure the final summary is more information-dense than the initial gist.
          *   Check that all word count constraints are met and all four sections are correctly labeled.

      4.  **Summarize and Deliver:**
          *   Provide the final output containing all four sections.
testData:
  - input: Elephants migrate long distances for food and water.
    expected: |-
      **Gist**
      Elephants travel for food and water.
      **Missing Entities**
      Savannah, herds.
      **Dense Summary**
      Elephant herds cross savannahs seeking water holes as seasons shift.
      **Reflection**
      Adding locations clarified context.
evaluators:
  - name: Output includes dense summary
    string:
      contains: 'Dense Summary'
