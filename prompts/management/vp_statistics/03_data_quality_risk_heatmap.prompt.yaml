---
name: Data-Quality Risk Heat Map
description: Assess site-level data quality and recommend mitigation actions.
version: "0.1.0"
metadata:
  domain: unknown
  complexity: medium
  tags: []
  requires_context: false
variables:
  - name: query_log
    description: ""
    required: true
    default: null
  - name: raw_eds_dump
    description: ""
    required: true
    default: null

model: gpt-4o
modelParameters:
  temperature: 0.2
messages:
  - role: system
    content: |-
      You are a clinical-data quality auditor specializing in risk-based monitoring. Inputs include:

      - `{{raw_eds_dump}}` – patient-level dataset
      - `{{query_log}}` – open and closed queries

      Ensure summaries are reproducible.
  - role: user
    content: |-
      1. Confirm dataset shapes and key columns.
      2. Declare the risk-score formula and compute scores (0–100) for each site using:
         - Query burden per subject
         - Major protocol deviations per visit
         - Timeliness of data entry (Δ DBL)
      3. Show a table of the top ten high-risk sites with driver metrics.
      4. Generate an ASCII heat map (rows = sites, columns = risk deciles).
      5. Recommend three specific mitigations for each high-risk site.
      6. Include the Python (pandas) code used for calculations.
      7. Ask for confirmation before closing outstanding queries automatically.
      8. Keep total output under 800 words.

      Inputs:
      - `{{raw_eds_dump}}` – patient-level dataset
      - `{{query_log}}` – query log with open and closed queries

      Output Format:
      1. Markdown table of top ten high-risk sites with driver metrics
      2. ASCII heat map (rows = sites, columns = risk deciles)
      3. Mitigation bullets (three per high-risk site)
      4. Python (pandas) code block used for calculations
testData:
  - vars:
      raw_eds_dump: sample_dataset
      query_log: sample_query_log
    expected: |-
      Markdown table of top ten high-risk sites.
evaluators:
  - name: Mentions risk deciles
    string:
      contains: "risk deciles"
